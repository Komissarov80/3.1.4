const URL = window.location.protocol + "//" + window.location.host + "/";

$('.newUser').click(async function () {
    let formData = new FormData(document.getElementById('newForm'));
    await fetch(URL + "admin", {
        method: 'POST',
        body: formData
    }).then(response => response.json()).then(user => {
        let table = document.getElementById('usersTable').getElementsByTagName('tbody')[0];
        let row = table.insertRow();
        row.setAttribute("style", "border-bottom 1px white");
        let text = document.createTextNode(user.id);
        let cell = row.insertCell();
        cell.append(text);
        cell = row.insertCell();
        text = document.createTextNode(user.name);
        cell.append(text);
        cell = row.insertCell();
        text = document.createTextNode(user.lastName);
        cell.append(text);
        cell = row.insertCell();
        text = document.createTextNode(user.age);
        cell.append(text);
        cell = row.insertCell();
        text = document.createTextNode(user.username);
        cell.append(text);
        cell = row.insertCell();
        console.log(JSON.stringify(user));
        let roles = "";
        $.map(user.roles, function (role, i) {
            roles = roles + role.name.substring(5);
        });
        text = document.createTextNode(roles);
        cell.append(text);
        cell = row.insertCell();
        let button = document.createElement('button');
        button.setAttribute('class', 'btn btn-info text-white')
        button.setAttribute('data-bs-toggle', "modal");
        button.setAttribute('data-bs-target', "#edit" + user.id);
        button.textContent = "Edit"
        cell.append(button);
        cell = row.insertCell();
        button = document.createElement('button');
        button.setAttribute('class', 'btn btn-danger');
        button.setAttribute('data-bs-toggle', 'modal');
        button.setAttribute('data-bs-target', '#delete' + user.id);
        button.textContent = "Delete"
        cell.append(button);
        let modalEdit = document.createElement('div');
        modalEdit.setAttribute('class', 'modal fade');
        modalEdit.setAttribute('tabindex', '-1');
        modalEdit.setAttribute('aria-labelledby', 'exampleModalLabel');
        modalEdit.setAttribute('aria-hidden', 'true');
        modalEdit.setAttribute('id', 'edit' + user.id);
        let modalDialog = document.createElement('div');
        modalDialog.setAttribute('class', 'modal-dialog');
        let editForm = document.createElement('form');
        editForm.setAttribute('id', 'editForm' + user.id);
        editForm.setAttribute('class', 'justify-content-center');
        let modalContent = document.createElement('div');
        modalContent.setAttribute('class', 'modal-content');
        let modalHeader = document.createElement('div');
        modalHeader.setAttribute('class', 'modal-header');
        let headerTitle = document.createElement('h5');
        headerTitle.setAttribute('class', 'modal-title');
        headerTitle.setAttribute('id', 'exampleModalLabel');
        headerTitle.textContent = 'Edit user';
        modalHeader.append(headerTitle);
        let headerButton = document.createElement('button');
        headerButton.setAttribute('class', 'btn-close');
        headerButton.setAttribute('data-bs-dismiss', 'modal');
        headerButton.setAttribute('aria-label', 'Close');
        modalHeader.append(headerButton)
        modalContent.append(modalHeader);
        let modalBody = document.createElement('div');
        modalBody.setAttribute('class', 'modal-body');
        let col = document.createElement('div');
        col.setAttribute('class', 'col-xl-5 col-lg-6 col-md-8 col-sm-10 mx-auto text-center form p-4');
        let px2 = document.createElement('div');
        px2.setAttribute('class', 'px-2');
        let formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        let strong = document.createElement('strong');
        let label = document.createElement('label');
        label.setAttribute('for', 'name');
        label.textContent = 'Id';
        strong.append(label);
        formGroup.append(strong);
        let input = document.createElement('input');
        input.setAttribute('type', 'id');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'id');
        input.setAttribute('value', user.id);
        input.setAttribute('disabled', 'true');
        input.setAttribute('readonly', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'name');
        label.textContent = "First name";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'name');
        input.setAttribute('value', user.name);
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'lastName');
        label.textContent = "Last name";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'lastName');
        input.setAttribute('value', user.lastName);
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'age');
        label.textContent = "Age";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'age');
        input.setAttribute('value', user.age);
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'username');
        label.textContent = "Email";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'username');
        input.setAttribute('value', user.username);
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'password');
        label.textContent = "Password";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'password');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'password');
        input.setAttribute('value', user.password);
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'role');
        label.textContent = 'Role';
        strong.append(label);
        formGroup.append(strong);
        let select = document.createElement('select');
        select.setAttribute('class', 'form-select');
        select.setAttribute('name', 'my_role');
        let option = document.createElement('option');
        option.setAttribute('value', 'ADMIN');
        option.textContent = 'ADMIN';
        select.append(option);
        option = document.createElement('option');
        option.setAttribute('value', 'USER');
        option.textContent = 'USER';
        select.append(option);
        formGroup.append(select);
        px2.append(formGroup);
        col.append(px2);
        modalBody.append(col);
        modalContent.append(modalBody);
        let modalFooter = document.createElement('div');
        modalFooter.setAttribute('class', 'modal-footer');
        button = document.createElement('button');
        button.setAttribute('type', 'button');
        button.setAttribute('class', 'btn btn-secondary');
        button.setAttribute('data-bs-dismiss', 'modal');
        button.textContent = 'Close';
        modalFooter.append(button);
        button = document.createElement('button');
        button.setAttribute('type', 'button');
        button.setAttribute('class', 'edit btn btn-primary');
        button.setAttribute('data-bs-dismiss', 'modal');
        button.setAttribute('id', user.id);
        button.textContent = 'Edit';
        modalFooter.append(button);
        modalContent.append(modalFooter);
        editForm.append(modalContent);
        modalDialog.append(editForm);
        modalEdit.append(modalDialog);
        table.append(modalEdit);
        let modalDelete = document.createElement('div');
        modalDelete.setAttribute('class', 'modal fade');
        modalDelete.setAttribute('tabindex', '-1');
        modalDelete.setAttribute('aria-labelledby', 'label');
        modalDelete.setAttribute('aria-hidden', 'true');
        modalDelete.setAttribute('id', 'delete' + user.id);
        modalDialog = document.createElement('div');
        modalDialog.setAttribute('class', 'modal-dialog');
        editForm = document.createElement('form');
        editForm.setAttribute('class', 'justify-content-center');
        modalContent = document.createElement('div');
        modalContent.setAttribute('class', 'modal-content');
        modalHeader = document.createElement('div');
        modalHeader.setAttribute('class', 'modal-header');
        headerTitle = document.createElement('h5');
        headerTitle.setAttribute('class', 'modal-title');
        headerTitle.setAttribute('id', 'label');
        headerTitle.textContent = 'Delete user';
        modalHeader.append(headerTitle);
        headerButton = document.createElement('button');
        headerButton.setAttribute('class', 'btn-close');
        headerButton.setAttribute('data-bs-dismiss', 'modal');
        headerButton.setAttribute('aria-label', 'Close');
        modalHeader.append(headerButton)
        modalContent.append(modalHeader);
        modalBody = document.createElement('div');
        modalBody.setAttribute('class', 'modal-body');
        col = document.createElement('div');
        col.setAttribute('class', 'col-xl-5 col-lg-6 col-md-8 col-sm-10 mx-auto text-center form p-4');
        px2 = document.createElement('div');
        px2.setAttribute('class', 'px-2');
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'name');
        label.textContent = 'Id';
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'id');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'id');
        input.setAttribute('value', user.id);
        input.setAttribute('disabled', 'true');
        input.setAttribute('readonly', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'name');
        label.textContent = "First name";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'name');
        input.setAttribute('value', user.name);
        input.setAttribute('disabled', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'lastName');
        label.textContent = "Last name";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'lastName');
        input.setAttribute('value', user.lastName);
        input.setAttribute('disabled', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'age');
        label.textContent = "Age";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'age');
        input.setAttribute('value', user.age);
        input.setAttribute('disabled', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'username');
        label.textContent = "Email";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'text');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'username');
        input.setAttribute('value', user.username);
        input.setAttribute('disabled', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'password');
        label.textContent = "Password";
        strong.append(label);
        formGroup.append(strong);
        input = document.createElement('input');
        input.setAttribute('type', 'password');
        input.setAttribute('class', 'form-control');
        input.setAttribute('name', 'password');
        input.setAttribute('value', user.password);
        input.setAttribute('disabled', 'true');
        formGroup.append(input);
        px2.append(formGroup);
        formGroup = document.createElement('div');
        formGroup.setAttribute('class', 'form-group');
        strong = document.createElement('strong');
        label = document.createElement('label');
        label.setAttribute('for', 'role');
        label.textContent = 'Role';
        strong.append(label);
        formGroup.append(strong);
        select = document.createElement('select');
        select.setAttribute('class', 'form-select');
        select.setAttribute('name', 'my_role');
        select.setAttribute('disabled', 'true');
        option = document.createElement('option');
        option.setAttribute('value', 'ADMIN');
        option.textContent = 'ADMIN';
        select.append(option);
        option = document.createElement('option');
        option.setAttribute('value', 'USER');
        option.textContent = 'USER';
        select.append(option);
        formGroup.append(select);
        px2.append(formGroup);
        col.append(px2);
        modalBody.append(col);
        modalContent.append(modalBody);
        modalFooter = document.createElement('div');
        modalFooter.setAttribute('class', 'modal-footer');
        button = document.createElement('button');
        button.setAttribute('type', 'button');
        button.setAttribute('class', 'btn btn-secondary');
        button.setAttribute('data-bs-dismiss', 'modal');
        button.textContent = 'Close';
        modalFooter.append(button);
        button = document.createElement('button');
        button.setAttribute('type', 'button');
        button.setAttribute('class', 'delete btn btn-danger');
        button.setAttribute('name', 'delete');
        button.setAttribute('data-bs-dismiss', 'modal');
        button.setAttribute('id', user.id);
        button.textContent = 'Delete';
        modalFooter.append(button);
        modalContent.append(modalFooter);
        editForm.append(modalContent);
        modalDialog.append(editForm);
        modalDelete.append(modalDialog);
        table.append(modalDelete);
    });
});